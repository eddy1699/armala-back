2026-02-09 22:36:13.365 -05:00 [INF] Iniciando Armala API...
2026-02-09 22:36:14.467 -05:00 [ERR] Hosting failed to start
System.IO.IOException: Failed to bind to address http://127.0.0.1:5069: address already in use.
 ---> Microsoft.AspNetCore.Connections.AddressInUseException: Solo se permite un uso de cada dirección de socket (protocolo/dirección de red/puerto)
 ---> System.Net.Sockets.SocketException (10048): Solo se permite un uso de cada dirección de socket (protocolo/dirección de red/puerto)
   at System.Net.Sockets.Socket.UpdateStatusAfterSocketErrorAndThrowException(SocketError error, Boolean disconnectOnFailure, String callerName)
   at System.Net.Sockets.Socket.DoBind(EndPoint endPointSnapshot, SocketAddress socketAddress)
   at System.Net.Sockets.Socket.Bind(EndPoint localEP)
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketTransportOptions.CreateDefaultBoundListenSocket(EndPoint endpoint)
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketConnectionListener.Bind()
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketConnectionListener.Bind()
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketTransportFactory.BindAsync(EndPoint endpoint, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Infrastructure.TransportManager.BindAsync(EndPoint endPoint, ConnectionDelegate connectionDelegate, EndpointConfig endpointConfig, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServerImpl.<>c__DisplayClass28_0`1.<<StartAsync>g__OnBind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindEndpointAsync(ListenOptions endpoint, AddressBindContext context, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindEndpointAsync(ListenOptions endpoint, AddressBindContext context, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.LocalhostListenOptions.BindAsync(AddressBindContext context, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.AddressesStrategy.BindAsync(AddressBindContext context, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindAsync(ListenOptions[] listenOptions, AddressBindContext context, Func`2 useHttps, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServerImpl.BindAsync(CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServerImpl.StartAsync[TContext](IHttpApplication`1 application, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Hosting.GenericWebHostService.StartAsync(CancellationToken cancellationToken)
   at Microsoft.Extensions.Hosting.Internal.Host.<StartAsync>b__15_1(IHostedService service, CancellationToken token)
   at Microsoft.Extensions.Hosting.Internal.Host.ForeachService[T](IEnumerable`1 services, CancellationToken token, Boolean concurrent, Boolean abortOnFirstException, List`1 exceptions, Func`3 operation)
2026-02-09 22:36:14.977 -05:00 [FTL] La aplicacion fallo al iniciar
System.IO.IOException: Failed to bind to address http://127.0.0.1:5069: address already in use.
 ---> Microsoft.AspNetCore.Connections.AddressInUseException: Solo se permite un uso de cada dirección de socket (protocolo/dirección de red/puerto)
 ---> System.Net.Sockets.SocketException (10048): Solo se permite un uso de cada dirección de socket (protocolo/dirección de red/puerto)
   at System.Net.Sockets.Socket.UpdateStatusAfterSocketErrorAndThrowException(SocketError error, Boolean disconnectOnFailure, String callerName)
   at System.Net.Sockets.Socket.DoBind(EndPoint endPointSnapshot, SocketAddress socketAddress)
   at System.Net.Sockets.Socket.Bind(EndPoint localEP)
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketTransportOptions.CreateDefaultBoundListenSocket(EndPoint endpoint)
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketConnectionListener.Bind()
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketConnectionListener.Bind()
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketTransportFactory.BindAsync(EndPoint endpoint, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Infrastructure.TransportManager.BindAsync(EndPoint endPoint, ConnectionDelegate connectionDelegate, EndpointConfig endpointConfig, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServerImpl.<>c__DisplayClass28_0`1.<<StartAsync>g__OnBind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindEndpointAsync(ListenOptions endpoint, AddressBindContext context, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindEndpointAsync(ListenOptions endpoint, AddressBindContext context, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.LocalhostListenOptions.BindAsync(AddressBindContext context, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.AddressesStrategy.BindAsync(AddressBindContext context, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindAsync(ListenOptions[] listenOptions, AddressBindContext context, Func`2 useHttps, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServerImpl.BindAsync(CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServerImpl.StartAsync[TContext](IHttpApplication`1 application, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Hosting.GenericWebHostService.StartAsync(CancellationToken cancellationToken)
   at Microsoft.Extensions.Hosting.Internal.Host.<StartAsync>b__15_1(IHostedService service, CancellationToken token)
   at Microsoft.Extensions.Hosting.Internal.Host.ForeachService[T](IEnumerable`1 services, CancellationToken token, Boolean concurrent, Boolean abortOnFirstException, List`1 exceptions, Func`3 operation)
   at Microsoft.Extensions.Hosting.Internal.Host.StartAsync(CancellationToken cancellationToken)
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.RunAsync(IHost host, CancellationToken token)
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.RunAsync(IHost host, CancellationToken token)
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.Run(IHost host)
   at Program.<Main>$(String[] args) in C:\Users\Moises\OneDrive\OneDrive - Universidad Peruana de Ciencias\Desktop\Armala\Backend\Armala\Program.cs:line 267
[2026-02-09 22:40:41.301 -05:00 INF] Iniciando Armala API...
[2026-02-09 22:40:41.539 -05:00 INF] Now listening on: http://localhost:5069
[2026-02-09 22:40:41.549 -05:00 INF] Application started. Press Ctrl+C to shut down.
[2026-02-09 22:40:41.552 -05:00 INF] Hosting environment: Development
[2026-02-09 22:40:41.558 -05:00 INF] Content root path: C:\Users\Moises\OneDrive\OneDrive - Universidad Peruana de Ciencias\Desktop\Armala\Backend\Armala
[2026-02-09 22:40:50.107 -05:00 WRN] Failed to determine the https port for redirect.
[2026-02-09 22:40:54.152 -05:00 INF] Executed DbCommand (226ms) [Parameters=[@__email_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='60']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [users] AS [u]
        WHERE [u].[email] = @__email_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
[2026-02-09 22:40:54.408 -05:00 INF] Executed DbCommand (135ms) [Parameters=[@__phoneNumber_0='?' (Size = 20)], CommandType='"Text"', CommandTimeout='60']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [users] AS [u]
        WHERE [u].[phone_number] = @__phoneNumber_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
[2026-02-09 22:40:54.572 -05:00 INF] Executed DbCommand (133ms) [Parameters=[@__dni_0='?' (Size = 8)], CommandType='"Text"', CommandTimeout='60']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [users] AS [u]
        WHERE [u].[dni] = @__dni_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
[2026-02-09 22:40:57.782 -05:00 INF] Executed DbCommand (131ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = DateTime2), @p2='?' (Size = 8), @p3='?' (Size = 255), @p4='?' (Size = 100), @p5='?' (DbType = Boolean), @p6='?' (Size = 255), @p7='?' (Size = 20), @p8='?' (Size = 4000), @p9='?' (Size = 20), @p10='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='60']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [users] ([id], [created_at], [dni], [email], [full_name], [is_verifired], [password_hash], [phone_number], [profile_picture_url], [status], [updated_at])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
[2026-02-09 22:40:58.066 -05:00 INF] Executed DbCommand (130ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = DateTime2), @p2='?' (DbType = DateTime2), @p3='?' (Size = 45), @p4='?' (DbType = Boolean), @p5='?' (Size = 255), @p6='?' (DbType = DateTime2), @p7='?' (Size = 4000), @p8='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='60']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [refresh_tokens] ([id], [created_at], [expires_at], [ip_address], [is_revoked], [token], [updated_at], [user_agent], [user_id])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
[2026-02-09 22:40:58.212 -05:00 INF] HTTP POST /api/Auth/register responded 201 in 8022.6902 ms
[2026-02-09 22:41:43.591 -05:00 INF] Executed DbCommand (123ms) [Parameters=[@__email_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='60']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [users] AS [u]
        WHERE [u].[email] = @__email_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
[2026-02-09 22:41:43.615 -05:00 WRN] Error en registro: El email ya está registrado
System.InvalidOperationException: El email ya está registrado
   at Armala.Armala.Auth.Application.CommandHandlers.RegisterUserCommandHandler.Handle(RegisterUserCommand request, CancellationToken cancellationToken) in C:\Users\Moises\OneDrive\OneDrive - Universidad Peruana de Ciencias\Desktop\Armala\Backend\Armala\Armala.Auth\Application\CommandHandlers\RegisterUserCommandHandler.cs:line 37
   at Armala.Auth.Interfaces.Controllers.AuthController.Register(RegisterRequestDto request) in C:\Users\Moises\OneDrive\OneDrive - Universidad Peruana de Ciencias\Desktop\Armala\Backend\Armala\Armala.Auth\Interfaces\Controllers\AuthController.cs:line 42
[2026-02-09 22:41:43.666 -05:00 INF] HTTP POST /api/Auth/register responded 400 in 230.0454 ms
[2026-02-09 22:42:10.544 -05:00 INF] Executed DbCommand (123ms) [Parameters=[@__email_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='60']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [users] AS [u]
        WHERE [u].[email] = @__email_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
[2026-02-09 22:42:10.683 -05:00 INF] Executed DbCommand (125ms) [Parameters=[@__phoneNumber_0='?' (Size = 20)], CommandType='"Text"', CommandTimeout='60']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [users] AS [u]
        WHERE [u].[phone_number] = @__phoneNumber_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
[2026-02-09 22:42:10.817 -05:00 INF] Executed DbCommand (123ms) [Parameters=[@__dni_0='?' (Size = 8)], CommandType='"Text"', CommandTimeout='60']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [users] AS [u]
        WHERE [u].[dni] = @__dni_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
[2026-02-09 22:42:10.834 -05:00 WRN] Error en registro: El DNI ya está registrado
System.InvalidOperationException: El DNI ya está registrado
   at Armala.Armala.Auth.Application.CommandHandlers.RegisterUserCommandHandler.Handle(RegisterUserCommand request, CancellationToken cancellationToken) in C:\Users\Moises\OneDrive\OneDrive - Universidad Peruana de Ciencias\Desktop\Armala\Backend\Armala\Armala.Auth\Application\CommandHandlers\RegisterUserCommandHandler.cs:line 45
   at Armala.Auth.Interfaces.Controllers.AuthController.Register(RegisterRequestDto request) in C:\Users\Moises\OneDrive\OneDrive - Universidad Peruana de Ciencias\Desktop\Armala\Backend\Armala\Armala.Auth\Interfaces\Controllers\AuthController.cs:line 42
[2026-02-09 22:42:10.847 -05:00 INF] HTTP POST /api/Auth/register responded 400 in 533.8086 ms
[2026-02-09 22:42:19.488 -05:00 INF] Executed DbCommand (124ms) [Parameters=[@__email_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='60']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [users] AS [u]
        WHERE [u].[email] = @__email_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
[2026-02-09 22:42:19.639 -05:00 INF] Executed DbCommand (123ms) [Parameters=[@__phoneNumber_0='?' (Size = 20)], CommandType='"Text"', CommandTimeout='60']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [users] AS [u]
        WHERE [u].[phone_number] = @__phoneNumber_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
[2026-02-09 22:42:19.780 -05:00 INF] Executed DbCommand (123ms) [Parameters=[@__dni_0='?' (Size = 8)], CommandType='"Text"', CommandTimeout='60']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [users] AS [u]
        WHERE [u].[dni] = @__dni_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
[2026-02-09 22:42:20.397 -05:00 ERR] Failed executing DbCommand (138ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = DateTime2), @p2='?' (Size = 8), @p3='?' (Size = 255), @p4='?' (Size = 100), @p5='?' (DbType = Boolean), @p6='?' (Size = 255), @p7='?' (Size = 20), @p8='?' (Size = 4000), @p9='?' (Size = 20), @p10='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='60']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [users] ([id], [created_at], [dni], [email], [full_name], [is_verifired], [password_hash], [phone_number], [profile_picture_url], [status], [updated_at])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
[2026-02-09 22:42:20.437 -05:00 ERR] An exception occurred in the database while saving changes for context type 'Armala.Auth.Infrastructure.Persistence.Context.ArmalaDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__users__A1936A6B7AA09FD8'. Cannot insert duplicate key in object 'dbo.users'. The duplicate key value is (+51933142109).
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:0d9fbc35-8aaa-4da0-a95c-24afe763484a
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__users__A1936A6B7AA09FD8'. Cannot insert duplicate key in object 'dbo.users'. The duplicate key value is (+51933142109).
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:0d9fbc35-8aaa-4da0-a95c-24afe763484a
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
[2026-02-09 22:42:20.513 -05:00 ERR] HTTP POST /api/Auth/register responded 500 in 1151.8608 ms
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__users__A1936A6B7AA09FD8'. Cannot insert duplicate key in object 'dbo.users'. The duplicate key value is (+51933142109).
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:0d9fbc35-8aaa-4da0-a95c-24afe763484a
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Armala.Auth.Infrastructure.Persistence.Repositories.UserRepository.AddAsync(User user) in C:\Users\Moises\OneDrive\OneDrive - Universidad Peruana de Ciencias\Desktop\Armala\Backend\Armala\Armala.Auth\Infrastructure\Persistence\Repositories\UserRepository.cs:line 66
   at Armala.Armala.Auth.Application.CommandHandlers.RegisterUserCommandHandler.Handle(RegisterUserCommand request, CancellationToken cancellationToken) in C:\Users\Moises\OneDrive\OneDrive - Universidad Peruana de Ciencias\Desktop\Armala\Backend\Armala\Armala.Auth\Application\CommandHandlers\RegisterUserCommandHandler.cs:line 67
   at Armala.Auth.Interfaces.Controllers.AuthController.Register(RegisterRequestDto request) in C:\Users\Moises\OneDrive\OneDrive - Universidad Peruana de Ciencias\Desktop\Armala\Backend\Armala\Armala.Auth\Interfaces\Controllers\AuthController.cs:line 42
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
[2026-02-09 22:42:20.575 -05:00 ERR] Error no controlado: An error occurred while saving the entity changes. See the inner exception for details.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of UNIQUE KEY constraint 'UQ__users__A1936A6B7AA09FD8'. Cannot insert duplicate key in object 'dbo.users'. The duplicate key value is (+51933142109).
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:0d9fbc35-8aaa-4da0-a95c-24afe763484a
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Armala.Auth.Infrastructure.Persistence.Repositories.UserRepository.AddAsync(User user) in C:\Users\Moises\OneDrive\OneDrive - Universidad Peruana de Ciencias\Desktop\Armala\Backend\Armala\Armala.Auth\Infrastructure\Persistence\Repositories\UserRepository.cs:line 66
   at Armala.Armala.Auth.Application.CommandHandlers.RegisterUserCommandHandler.Handle(RegisterUserCommand request, CancellationToken cancellationToken) in C:\Users\Moises\OneDrive\OneDrive - Universidad Peruana de Ciencias\Desktop\Armala\Backend\Armala\Armala.Auth\Application\CommandHandlers\RegisterUserCommandHandler.cs:line 67
   at Armala.Auth.Interfaces.Controllers.AuthController.Register(RegisterRequestDto request) in C:\Users\Moises\OneDrive\OneDrive - Universidad Peruana de Ciencias\Desktop\Armala\Backend\Armala\Armala.Auth\Interfaces\Controllers\AuthController.cs:line 42
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at AspNetCoreRateLimit.RateLimitMiddleware`1.Invoke(HttpContext context) in C:\Users\User\Documents\Github\AspNetCoreRateLimit\src\AspNetCoreRateLimit\Middleware\RateLimitMiddleware.cs:line 124
   at Program.<>c.<<<Main>$>b__0_6>d.MoveNext() in C:\Users\Moises\OneDrive\OneDrive - Universidad Peruana de Ciencias\Desktop\Armala\Backend\Armala\Program.cs:line 211
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Armala.Auth.Interfaces.Middleware.ExceptionHandlingMiddleware.InvokeAsync(HttpContext context) in C:\Users\Moises\OneDrive\OneDrive - Universidad Peruana de Ciencias\Desktop\Armala\Backend\Armala\Armala.Auth\Interfaces\Middleware\ExceptionHandlingMiddleware.cs:line 21
[2026-02-09 22:43:13.603 -05:00 INF] Executed DbCommand (123ms) [Parameters=[@__email_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='60']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [users] AS [u]
        WHERE [u].[email] = @__email_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
[2026-02-09 22:43:13.741 -05:00 INF] Executed DbCommand (123ms) [Parameters=[@__phoneNumber_0='?' (Size = 20)], CommandType='"Text"', CommandTimeout='60']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [users] AS [u]
        WHERE [u].[phone_number] = @__phoneNumber_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
[2026-02-09 22:43:13.877 -05:00 INF] Executed DbCommand (123ms) [Parameters=[@__dni_0='?' (Size = 8)], CommandType='"Text"', CommandTimeout='60']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [users] AS [u]
        WHERE [u].[dni] = @__dni_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
[2026-02-09 22:43:14.469 -05:00 INF] Executed DbCommand (129ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = DateTime2), @p2='?' (Size = 8), @p3='?' (Size = 255), @p4='?' (Size = 100), @p5='?' (DbType = Boolean), @p6='?' (Size = 255), @p7='?' (Size = 20), @p8='?' (Size = 4000), @p9='?' (Size = 20), @p10='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='60']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [users] ([id], [created_at], [dni], [email], [full_name], [is_verifired], [password_hash], [phone_number], [profile_picture_url], [status], [updated_at])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
[2026-02-09 22:43:14.643 -05:00 INF] Executed DbCommand (153ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = DateTime2), @p2='?' (DbType = DateTime2), @p3='?' (Size = 45), @p4='?' (DbType = Boolean), @p5='?' (Size = 255), @p6='?' (DbType = DateTime2), @p7='?' (Size = 4000), @p8='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='60']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [refresh_tokens] ([id], [created_at], [expires_at], [ip_address], [is_revoked], [token], [updated_at], [user_agent], [user_id])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
[2026-02-09 22:43:14.653 -05:00 INF] HTTP POST /api/Auth/register responded 201 in 1174.4168 ms
